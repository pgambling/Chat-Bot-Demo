# Meme Bot Demo for JS Day

This is an example Telegram messenger bot I built for a talk about chat bots using [AWS Lex](https://docs.aws.amazon.com/lex/latest/dg/what-is.html) and Lambda functions. Its only purpose in life is to build meme images for your enjoyment.

You can try it out here https://t.me/jsdaymemebot.

The bot's architecture is as follows:

![Bot Architecture](diagram.png)

Messages are sent from Telegram to a webhook implemented with API gateway and a lambda function. The webhook lambda forwards those messages on to AWS Lex to interpret what the user is saying. Lex then delegates to another set of lambdas to validate and fulfill the user's request. A third party service, imgflip.com, is used to generate the meme images which are sent back to the user Telegram chat session.

# Tagged Demos from my JS Day Talk

The state of the code for each demo during my talk has been tagged for reference.

1. [Optional Fields](https://github.com/pgambling/Chat-Bot-Demo/releases/tag/demo1-optional-fields) - Making top and bottom text slots optional depending on text placement value. 
2. [Meme Name Validation](https://github.com/pgambling/Chat-Bot-Demo/releases/tag/demo2-memeName-validation) - Validating the meme name as soon as the user enters it and handling errors earlier in the conversation.
3. [Using Session Attribute](https://github.com/pgambling/Chat-Bot-Demo/releases/tag/demo3-session-attributes) - Tracking data in Lex's session attributes for the user in order to share state between and switch to different intents.

# How to deploy your own instance

## Prerequisites

1. An [AWS](https://aws.amazon.com/) account.
1. Install Serverless Framework and configure it for your AWS account. See [this guide](https://serverless.com/framework/docs/providers/aws/guide/) for help.
1. A [Telegram Messenger](https://telegram.org/) account.
1. Create an account on [imgflip](https://imgflip.com/).

## Deploying a new bot

1. Create a new Telegram bot using [Botfather](https://core.telegram.org/bots#creating-a-new-bot).
1. Log in to the AWS console and navigate to Lex.
1. Create a Lex bot by importing `lex-configs/MemeBot_Export.json`. This is an export of my own Lex bot which contains references to Lambda function ids that won't exist in your own AWS account. You will need to manually update these after deploying with Serverless.
1. Make an env.yml file in the root directory using example-env.yml as the template.
1. Fill in your Lex bot name and alias, imgflip credentials, and Telegram bot token in env.yml.
1. Run `sls deploy` from the console to deploy the lambda functions and create HTTP endpoints.
1. Connect Telegram to your newly deployed webhook endpoint by sending a POST request to `https://api.telegram.org/bot<YOUR TELEGRAM BOT TOKEN HERE>/` with the request body of `{ "url": "YOUR DEPLOYED WEBHOOK URL HERE"}`
  1. The deployed webhook URL will have been generated by `sls deploy` and look something like `https://4o06vdkll7.execute-api.us-east-1.amazonaws.com/demo/telegram/webhook`
1. Your bot is ready to go, try it out in Telegram.

## Updating the bot

Making changes to the bot after deployment is simple and doesn't require a full deployment as described above.

To update the lambda functions, run `sls deploy` or just `sls deploy -f <name of function>` to update a single function.

To update any of the Lex bot configuration, make changes via the Lex console in AWS.

# Useful References

- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Lex Input Event and Response Formats](https://docs.aws.amazon.com/lex/latest/dg/lambda-input-response-format.html)
- [Serverless Guide for AWS](https://serverless.com/framework/docs/providers/aws/guide/)

# Disclaimer

I make no claims that any of the code in this project is production worthy and caution you to use at your own risk. It only serves as an example for learning purposes and starting point to build from.



